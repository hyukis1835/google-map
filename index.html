
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カスタム Google Map（イタリア）</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZPRJzf-rbyrdjWjmJYWYpb74dnfLjkHw&language=ja"></script>
</head>
<body>
  <div id="map"></div>
  <script>
    const defaultLat = 41.9028;  // ローマ
    const defaultLng = 12.4964;
    const defaultZoom = 6;

    let lat = defaultLat;
    let lng = defaultLng;
    let zoom = defaultZoom;

    try {
      const savedLat = parseFloat(localStorage.getItem('mapLat'));
      const savedLng = parseFloat(localStorage.getItem('mapLng'));
      const savedZoom = parseFloat(localStorage.getItem('mapZoom'));
      if (!isNaN(savedLat)) lat = savedLat;
      if (!isNaN(savedLng)) lng = savedLng;
      if (!isNaN(savedZoom)) zoom = savedZoom;
    } catch (e) {}

    const map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: lat, lng: lng },
      zoom: zoom,
      mapTypeId: 'roadmap',
      gestureHandling: 'greedy', // ← PCでもドラッグ可能・スマホ警告非表示
      disableDoubleClickZoom: true,
      scrollwheel: false, // マウスホイールズーム無効
      draggable: true     // 念のため明示
    });

    const kmlLayer = new google.maps.KmlLayer({
      url: `${location.origin}/map.kml`,
      map: map,
      preserveViewport: true
    });

    try {
      map.addListener('idle', () => {
        const center = map.getCenter();
        localStorage.setItem('mapLat', center.lat());
        localStorage.setItem('mapLng', center.lng());
        localStorage.setItem('mapZoom', map.getZoom());
      });
    } catch (e) {}
  </script>
</body>
</html>
