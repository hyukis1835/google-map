
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カスタム Google Map</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZPRJzf-rbyrdjWjmJYWYpb74dnfLjkHw&language=ja"></script>
</head>
<body>
  <div id="map"></div>
  <script>
    const defaultLat = 35.6811673;
    const defaultLng = 139.7670516;
    const defaultZoom = 14;

    const savedLat = parseFloat(localStorage.getItem('mapLat'));
    const savedLng = parseFloat(localStorage.getItem('mapLng'));
    const savedZoom = parseFloat(localStorage.getItem('mapZoom'));

    const map = new google.maps.Map(document.getElementById('map'), {
      center: {
        lat: savedLat || defaultLat,
        lng: savedLng || defaultLng
      },
      zoom: savedZoom || defaultZoom,
      mapTypeId: 'roadmap',
      gestureHandling: 'greedy' // ← スマホで1本指操作可能
    });

    // KMLレイヤーを追加
    const kmlLayer = new google.maps.KmlLayer({
      url: `${location.origin}/map.kml`,
      map: map,
      preserveViewport: true // ← マップの初期位置をKMLに上書きされないようにする
    });

    // マップの移動・ズームを記録
    map.addListener('idle', () => {
      const center = map.getCenter();
      localStorage.setItem('mapLat', center.lat());
      localStorage.setItem('mapLng', center.lng());
      localStorage.setItem('mapZoom', map.getZoom());
    });
  </script>
</body>
</html>
