
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Custom Google Map</title>
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    /* モバイルで1本指スクロール禁止 */
    body {
      touch-action: pan-x pan-y;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZPRJzf-rbyrdjWjmJYWYpb74dnfLjkHw&language=ja"></script>
</head>
<body>
  <div id="map"></div>
  <script>
    let defaultCenter = { lat: 41.9028, lng: 12.4964 }; // イタリア（ローマ）
    let defaultZoom = 6;

    const savedCenter = JSON.parse(localStorage.getItem("mapCenter"));
    const savedZoom = parseInt(localStorage.getItem("mapZoom"));

    const map = new google.maps.Map(document.getElementById("map"), {
      center: savedCenter || defaultCenter,
      zoom: savedZoom || defaultZoom,
      mapTypeId: "roadmap",
      gestureHandling: "greedy",  // PCでスクロールズーム可・モバイルは警告なし2本指操作のみ
      disableDoubleClickZoom: false // ダブルクリックズームを有効に
    });

    // KML Layer 読み込み
    const kmlLayer = new google.maps.KmlLayer({
      url: location.origin + location.pathname.replace(/\/[^/]*$/, '') + '/map.kml',
      map: map,
      preserveViewport: true
    });

    // 位置とズームの記憶
    map.addListener("idle", () => {
      const center = map.getCenter();
      localStorage.setItem("mapCenter", JSON.stringify({ lat: center.lat(), lng: center.lng() }));
      localStorage.setItem("mapZoom", map.getZoom());
    });
  </script>
</body>
</html>
